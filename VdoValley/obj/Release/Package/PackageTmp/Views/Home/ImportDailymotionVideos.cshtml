
@{
    ViewBag.Title = "ImportDailymotionVideos";
}

<h2>ImportDailymotionVideos</h2>

@using (Ajax.BeginForm("GetDailymotionVideos", "Home", new { EmbedId = 1 },
    new AjaxOptions
    {
        InsertionMode = InsertionMode.Replace,
        HttpMethod = "GET",
        OnFailure = "ajaxFailed",
        LoadingElementId = "ajax-loader",
        UpdateTargetId = "searchresults",
        OnComplete = "ajaxComplete",
        OnSuccess = "ajaxSuccess"
    }, new { id = "SelectFacebookPageForm" })
)
{
    @Html.DropDownList("SelectDailymotionSource", new SelectList(
        new List<Object> {
            new { value = "zemtv", text = "Zem TV"  },
            new { value = "vdovalley", text = "VdoValley"  },
            new { value = "Aman_Asif", text = "Aman Asif" },
            new { value = "glowtvpk", text = "GlowTvPK" },
            new { value = "fashioncentralpk", text = "FashionCentralPK" },
            new { value = "PkdanceCreations", text = "PkDanceCreations" },
            new { value = "eddythunderstorms", text = "EddyThunderStorms Funny Videos" },
            new { value = "funnyworld20", text = "FunnyWorld20" },
            new { value = "PTVSports", text = "PTVSports" },
            new { value = "ak472522", text = "AK472522" },
            new { value = "mubashir-luqman", text = "Mubashir-Luqman" },
            new { value = "imrankhan012", text = "ImranKhan012" }
        },
        "value",
        "text", 0))
    <img id="ajax-loader" src="@Url.Content("~/Images/ajax-loader.gif")" style="display:none;width:20px;" />
}

<div id="searchresults"></div>

<script src="http://api.dmcdn.net/all.js"></script>    
<script>
    DM.init({
        apiKey: 'c3aae1f9b8cf64a567a8',
        status: true, // check login status
        cookie: true // enable cookies to allow the server to access the session
    });

    function getDailymotionVideos(source) {
        $(".table tbody").html("");
        DM.getLoginStatus();
        DM.api("/user/" + source + "/videos", { limit: 100, page: 1 }, function (response) {
            //alert('Got ' + response.list.length + ' videos' + (response.has_more ? ' and has more' : ''));
            $(response.list).each(function (k, v) {
                
                var thumbUrl = null;
                DM.api("/video/" + v.id + "?fields=thumbnail_small_url", function (response) {
                    thumbUrl = response.thumbnail_small_url;
                    $(".table tbody").append("<tr>" +
                        "<td>" + v.id + "</td>" +
                        "<td class='video-title'>" + v.title + "</td>" +
                        "<td><a href='http://dai.ly/" + v.id + "' target='_blank'><img src='" + thumbUrl + "' /></a></td>" +
                        "<td class='suggested-tags'></td>" +
                        "<td>" + getForm(v.id, v.title) + "</td>" +
                    "</tr>");
                });
            });
        });
    }

    $("#SelectDailymotionSource").change(function () {
        getDailymotionVideos($(this).val())
    });

    function getForm(EmbedId, Title)
    {
        return "<form class='addToVdoValleyForm'" +
            "method='post'" +
            "action='/Home/ImportFacebookVideo'>" +
            "<input type='hidden' value='" + EmbedId + "' name='EmbedId'>" +
            "<input type='hidden' value='" + Title.replace(/'/g, "%27") + "' name='Title'>" +
            "<input type='hidden' value='' name='Description'>" +
            "<input type='hidden' value='' name='EmbedCode'>" +
            "<input type='hidden' value='' name='PageName'>" +
            "<input type='hidden' value='" + $("#VideoTypeId").val() + "' name='VideoTypeId'>" +
            "<input type='text' value=\"\" name='InputTags' id='InputTags'>" +
            "<select id='SelectedCategory' name='SelectedCategory'>" +
                "<option value=''>-Select Category-</option>" +
                "<option value='1'>General Category</option>" +
                "<option value='12'>Funny Videos</option>" +
                "<option value='13'>Politics</option>" +
                "<option value='14'>Sports</option>" +
                "<option value='15'>Fashion &amp; Designing</option>" +
                "<option value='16'>Talk Show</option>" +
                "<option value='17'>News</option>" +
                "<option value='18'>TV Program</option>" +
            "</select>" +
            "<input id='Tags' name='Tags' type='hidden' value=\"\">" +
            "<input type='submit' value='Add'>" +
            "<img class=\"ajax-loader\" src=\"/Images/ajax-loader.gif\" style=\"display:none;width:20px;\" /></form>";
    }

    $(function () {
        $(document).on("submit", ".addToVdoValleyForm", function (e) {
            $(this).find(".ajax-loader").show();

            var data = {
                vvm: {
                    EmbedId: $(this).find("input[name='EmbedId']").val(),
                    Title: $(this).find("input[name='Title']").val(),
                    Description: $(this).find("input[name='Description']").val(),
                    EmbedCode: null,
                    PageName: null,
                    VideoTypeId: $(this).find("input[name='VideoTypeId']").val(),
                    SelectedCategory: $(this).find("select[name='SelectedCategory']").val(),
                    Tags: $(this).find("input[name='Tags']").val()
                }
            };
            
            $.ajax({
                url: "/Home/ImportFacebookVideo",
                type:"POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(data),
                complete: function (xhr, status) {
                    alert(JSON.stringify(xhr));
                    $(this).find(".ajax-loader").show();
                }
            });

            e.preventDefault();
        });
    });

</script>

<div id="videos"></div>

<style>
    .nav-pills li a {
        background-color: lightgray;
    }

    #suggested-tags {
        margin-left: 18%;
    }
</style>

<table class="table">
    <tr id="theader">
        <th>Id</th>
        <th>Title</th>
        <th>Preview</th>
        <th>Tags</th>
        <th>Import</th>
        <th></th>
    </tr>
    <tbody>

    </tbody>
</table>

<input type="hidden" value="@ViewBag.VideoTypeId" id="VideoTypeId">

<script src="~/Scripts/AutoTagsSuggestion.js"></script>