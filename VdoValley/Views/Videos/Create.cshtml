@model VdoValley.ViewModels.VideoViewModel

@{
    ViewBag.Title = "Submit Video";
}

<h2>Submit Video</h2>

<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
<script src="http://api.dmcdn.net/all.js"></script>
<script>
    DM.init({
        apiKey: 'c3aae1f9b8cf64a567a8',
        status: true, // check login status
        cookie: true // enable cookies to allow the server to access the session
    });
</script>
<script>
    $(function () {
        $("#Title").keyup(function () {

            var tokens = $(this).val().split(" ");
            var tags = [];

            $(tokens).each(function (key, value) {
                var tag = {
                    Name:value
                };
                tags.push(tag);
            });
                        
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetTags", "Tags")",
                data: JSON.stringify(tags),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    handleData(response);
                },
                error: function (xhr, status, error) {
                    handleData(xhr.responseText);
                }
            });
        });

        function handleData(data) {
            console.log(data);
            $(data).each(function (key, val) {
                appendTag(val.Name);
            });
        }

        $("#suggested-tags").on("click", ".active", function (e) {
            e.preventDefault();

            // get the tagName which is clicked and needs to be removed
            var tagName = $(this).find("a").text();

            // get hidden Tags input value
            var tags = $("input[name='Tags']").val();

            // split the value by comman to make array
            tagArray = tags.split(",");
            
            // get index of tagName to be removed
            var index = tagArray.indexOf(tagName);

            // remove the tag from array
            tagArray.splice(index, 1);

            // join the updated array to make updated comma separated string
            var updatedTags = tagArray.join();

            // update the hidden Tags field with new comman separated tags string
            $("input[name='Tags']").val(updatedTags);

            // remove the clicked tag
            $(this).remove();
        });

        $("input[name='inputTags']").keyup(function (e) {
            if ($(this).val().substr(-1) == ",") {
                appendTag($(this).val().substring(0, $(this).val().length - 1));        
                $(this).val("");
            }
        });
        
        function appendTag(tagName) {
            if ($("#suggested-tags").find("#" + tagName).length > 0) return;
            var li = "<li class=\"active\" id=\"" + tagName + "\"><a href=\"#\" style=\"background-color: #EEEEEE;padding:5px;color:grey;text-transform: lowercase;\">" + tagName + "</a></li>";
            $("#suggested-tags").append(li);

            if ($("input[name='Tags").val().length == 0) {
                $("input[name='Tags").val(tagName);
            } else {
                $("input[name='Tags").val($("input[name='Tags").val() + "," + tagName);
            }
        }

        $("#Url").keyup(function () {
            $.ajax({
                type: "GET",
                url: "https://api.dailymotion.com/video/x26ezj5?fields=id,title",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    alert(response)
                },
                error: function (xhr, status, error) {
                    handleData(xhr.responseText);
                }
            });
        });

    });

    
</script>

<div ng-app="">
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        <div class="form-horizontal">
            <hr />

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="form-group">
                @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control", ng_model = "name" } })
                    @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
                </div>
            </div>
            
            <div class="form-group">
                @Html.LabelFor(model => model.Url, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.Url, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Url, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.Description, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.SelectedCategory, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.DropDownListFor(model => model.SelectedCategory, new SelectList(TempData["Categories"] as System.Collections.IEnumerable, "CategoryID", "Name"), "-Select Category-", htmlAttributes: new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.SelectedCategory, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2" for="Tags">Tags</label>
                <div class="col-md-10">
                    <input class="form-control tagsinput text-box single-line" id="tags_1_tagsinput" name="inputTags" type="text" value="">
                    <span class="field-validation-valid text-danger" data-valmsg-for="Tags" data-valmsg-replace="true"></span>
                    <input id="tags_1_tagsinput" name="Tags" type="hidden" value="">
                </div>
            </div>
            
            <div class="form-group">
                <style>
                    .nav-pills li a {
                        background-color: lightgray;
                    }
                    #suggested-tags {
                        margin-left: 18%;
                    }
                </style>
                <ul class="nav nav-pills col-lg-offset-6 col-lg-10" id="suggested-tags">
                    <!--<li class="active"><a href="#" style="background-color: #EEEEEE;padding:5px;color:grey;">Home</a></li>-->
                </ul>
            </div>
           
                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="submit" value="Create" class="btn btn-default" />
                    </div>
                </div>
            </div>
    }
</div>

<ul class="pull-right"><li><a href="#">Pulled Right</a></li></ul>
<ul class="pull-right"><li><a href="#">Pulled Right</a></li></ul>

<div>
    @Html.ActionLink("Back to List", "Index")
</div>
@section styles{
 
<link href="~/Scripts/jquery-tags-input/jquery.tagsinput.css" rel="stylesheet" />
 }
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/jquery-tags-input/jquery.tagsinput.js"></script>
}
